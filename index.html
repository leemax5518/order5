<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>åª½åª½æ¨‚æ—©é¤å±‹ - é»é¤ç³»çµ±</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    margin:0; padding:0;
    color:#333;
  }
  header {
    background:#ffcc80;
    color:#5d4037;
    padding:1em;
    text-align:center;
    font-weight:bold;
    font-size:1.4em;
  }
  .content {
    padding:1em;
  }
  .category-btn, .action-btn {
    display:block;
    width:100%;
    padding:1.2em;
    margin:.7em 0;
    font-size:1.2em;
    background:white;
    border:none;
    border-radius:8px;
    box-shadow:0 1px 4px rgba(0,0,0,0.2);
    transition:background .2s;
  }
  .category-btn:hover, .action-btn:hover {
    background:#ffe0b2;
  }
  .item {
    background:white;
    border-radius:8px;
    padding:1em;
    margin:.6em 0;
    box-shadow:0 1px 4px rgba(0,0,0,0.1);
  }
  .item-name {
    font-weight:bold;
    font-size:1.1em;
  }
  .controls {
    display:flex;
    align-items:center;
    flex-wrap:wrap;
    margin-top:.6em;
  }
  .controls button {
    width:38px;
    height:38px;
    font-size:1.2em;
    border:none;
    background:#ffcc80;
    color:#5d4037;
    border-radius:4px;
    margin-right:.4em;
  }
  .controls input {
    width:50px;
    text-align:center;
    font-size:1em;
  }
  .size-btn, .taste-btn {
    padding:.5em 1em;
    margin:.3em .3em .3em 0;
    border:1px solid #ccc;
    border-radius:4px;
    font-size:1em;
    cursor:pointer;
  }
  .size-btn.active, .taste-btn.active {
    background:#ffb74d;
    color:white;
    border:none;
  }
  .cart-item {
    padding:.6em 0;
    border-bottom:1px solid #ddd;
    font-size:1.1em;
  }
  .cart-item button {
    margin-left:.5em;
    padding:.3em .6em;
  }
  .total {
    font-size:1.3em;
    text-align:right;
    margin-top:1em;
    font-weight:bold;
  }
  .hidden { display:none; }
</style>
</head>
<body>
<header>åª½åª½æ¨‚æ—©é¤å±‹</header>

<div class="content" id="categoriesView"></div>

<div class="content hidden" id="subcategoriesView">
  <h3 id="subTitle"></h3>
  <div id="subList"></div>
  <button class="action-btn" onclick="backToCategories()">è¿”å›åˆ†é¡</button>
</div>

<div class="content hidden" id="itemsView">
  <h3 id="itemsTitle"></h3>
  <div id="itemsList"></div>
  <button class="action-btn" onclick="backToCategories()">è¿”å›åˆ†é¡</button>
  <button class="action-btn" onclick="showCart()">æŸ¥çœ‹è¨‚å–®</button>
</div>

<div class="content hidden" id="cartView">
  <h3>å·²é¸è³¼é …ç›®ï¼š</h3>
  <div id="cartList"></div>
  <div class="total">ç¸½é‡‘é¡ï¼š<span id="cartTotal">0</span> å…ƒ</div>
  <button class="action-btn" onclick="submitOrder()">é€å‡ºè¨‚å–®</button>
  <button class="action-btn" onclick="backToCategories()">ç¹¼çºŒé¸è³¼</button>
</div>

<script>
// ğŸŸ¢ å®Œæ•´èœå–®
const menuData = [
  {
    category: "ä¸‰æ˜æ²»/æ¼¢å ¡",
    subcategories: [
      {
        name: "ä¸‰æ˜æ²»",
        items: [
          { name:"è”¬èœ", price:40 },
          { name:"ç«è…¿", price:40 },
          { name:"è‚‰é¬†", price:40 },
          { name:"åŸ¹æ ¹", price:40 },
          { name:"è±¬è‚‰", price:40 },
          { name:"é®®è¦", price:45 },
          { name:"ç‰ç±³", price:45 },
          { name:"è–¯æ³¥æ²™æ‹‰", price:45 },
          { name:"é¦™é›", price:45 },
          { name:"ç‡»é›", price:45 },
          { name:"è–¯é¤…", price:45 },
          { name:"è±¬æ’", price:50 },
          { name:"é®ªé­š", price:50 },
          { name:"è²åŠ›é›", price:50 },
          { name:"æŸšé¦™èŠ±æ", price:55 },
          { name:"é±ˆé­šèµ·å£«", price:60 },
          { name:"ç¾©å¼é¦™è‰é›", price:60 },
          { name:"å¡æ‹‰é›(è¾£å‘³)", price:60 }
        ]
      },
      {
        name: "æ¼¢å ¡",
        items: [
          { name:"è”¬èœ", price:40 },
          { name:"ç«è…¿", price:40 },
          { name:"è‚‰é¬†", price:40 },
          { name:"åŸ¹æ ¹", price:40 },
          { name:"è±¬è‚‰", price:40 },
          { name:"é®®è¦", price:45 },
          { name:"ç‰ç±³", price:45 },
          { name:"è–¯æ³¥æ²™æ‹‰", price:45 },
          { name:"é¦™é›", price:45 },
          { name:"ç‡»é›", price:45 },
          { name:"è–¯é¤…", price:45 },
          { name:"è±¬æ’", price:50 },
          { name:"é®ªé­š", price:50 },
          { name:"è²åŠ›é›", price:50 },
          { name:"æŸšé¦™èŠ±æ", price:55 },
          { name:"é±ˆé­šèµ·å£«", price:60 },
          { name:"ç¾©å¼é¦™è‰é›", price:60 },
          { name:"å¡æ‹‰é›(è¾£å‘³)", price:60 }
        ]
      }
    ]
  },
  {
    category: "è›‹é¤…",
    items: [
      { name:"åŸå‘³", price:30 },
      { name:"èµ·å£«", price:40 },
      { name:"è”¬èœ", price:40 },
      { name:"ç«è…¿", price:40 },
      { name:"åŸ¹æ ¹", price:40 },
      { name:"è‚‰é¬†", price:45 },
      { name:"ç‰ç±³", price:45 },
      { name:"è–¯æ³¥æ²™æ‹‰", price:50 },
      { name:"è–¯é¤…", price:50 },
      { name:"å¾·åœ‹é¦™è…¸", price:50 },
      { name:"è±¬æ’", price:50 },
      { name:"ç‡»é›", price:50 },
      { name:"é®ªé­š", price:50 }
    ]
  },
 {
  category: "éµæ¿éºµ/ç¾©å¤§åˆ©éºµ",
  subcategories: [
    {
      name: "éµæ¿éºµ",
      items: [
        { name: "è˜‘è‡", price: 60 },
        { name: "é»‘èƒ¡æ¤’", price: 60 },
        { name: "åŸ¹æ ¹", price: 70, tasteOptions: ["è˜‘è‡", "é»‘èƒ¡æ¤’"] },
        { name: "è±¬æ’", price: 75, tasteOptions: ["è˜‘è‡", "é»‘èƒ¡æ¤’"] },
        { name: "é¦™é›", price: 75, tasteOptions: ["è˜‘è‡", "é»‘èƒ¡æ¤’"] }
      ]
    },
    {
      name: "ç¾©å¤§åˆ©éºµ",
      items: [
        { name: "ç´…é†¬ç¾©å¤§åˆ©éºµ", price: 75 },
        { name: "é’é†¬ç¾©å¤§åˆ©éºµ", price: 75 },
        { name: "ç™½é†¬ç¾©å¤§åˆ©éºµ", price: 90 },
        { name: "æ³°å¼èŠ±æ", price: 80 }
      ]
    }
  ]
},

  {
    category: "é£²æ–™",
    items: [
      { name:"ç´…èŒ¶", priceM:25, priceL:30 },
      { name:"å¥¶èŒ¶", priceM:25, priceL:30 },
      { name:"ç„¡ç³–ç¶ èŒ¶", priceM:25, priceL:30 },
      { name:"è±†æ¼¿(å†°)", priceM:25, priceL:30 },
      { name:"ç´…èŒ¶è±†æ¼¿", priceM:30, priceL:40 },
      { name:"æŸ³æ©™æ±", priceM:30, priceL:35 },
      { name:"è”“è¶Šè“æ±", priceM:30, priceL:35 },
      { name:"ç™¾é¦™æœæ±", priceM:30, priceL:35 },
      { name:"ç™¾é¦™ç´…èŒ¶", priceM:30, priceL:35 },
      { name:"æª¸æª¬ç´…èŒ¶", priceM:30, priceL:35 },
      { name:"é´›é´¦å¥¶èŒ¶", priceM:35, priceL:40 },
      { name:"é®®å¥¶èŒ¶", priceM:35, priceL:45 },
      { name:"æŸšå­å†°èŒ¶", priceM:35, priceL:45 },
      { name:"å¯å¯", priceM:35, priceL:45 },
      { name:"é˜¿è¯ç”°", priceM:40, priceL:50 },
      { name:"å¯æ¨‚", priceM:35, priceL:35 },
      { name:"é›ªç¢§", priceM:35, priceL:35 },
      { name:"ç ”ç£¨å’–å•¡", priceM:40, priceL:55 },
      { name:"æ‹¿éµ", priceM:50, priceL:65 }
    ]
  },
  {
    category: "å–®é»",
    items: [
      { name:"è·åŒ…è›‹", price:15 },
      { name:"èµ·å£«", price:20 },
      { name:"ç«è…¿", price:20 },
      { name:"åŸ¹æ ¹", price:20 },
      { name:"è”¬èœ", price:25 },
      { name:"è–¯é¤…", price:25 },
      { name:"è±¬è‚‰", price:25 },
      { name:"è±¬æ’", price:30 },
      { name:"å¾·åœ‹é¦™è…¸", price:30 },
      { name:"é¦™é›", price:30 },
      { name:"ç‡»é›", price:30 },
      { name:"è–¯æ³¥æ²™æ‹‰", price:35 },
      { name:"ç‰›è‚‰", price:35 },
      { name:"é®®è¦", price:35 },
      { name:"ç‰ç±³è›‹", price:40 },
      { name:"è²åŠ›é›", price:40 },
      { name:"é±ˆé­š", price:40 },
      { name:"ç¾©å¼é¦™è‰é›", price:45 },
      { name:"å¡æ‹‰é›(è¾£å‘³)", price:50 }
    ]
  },
  {
    category: "é»å¿ƒ/åå¸",
    items: [
      { name:"å°ç†±ç‹—", price:35 },
      { name:"ç†±ç‹—æ²", price:40 },
      { name:"è–„ç‰‡åå¸", price:30 },
      { name:"è”¥æŠ“é¤…", price:40 },
      { name:"è–¯æ¢", price:45 },
      { name:"å°é›çƒ", price:45 },
      { name:"è˜¿è””ç³•", price:45 },
      { name:"ç…é¤ƒ(8é¡†)", price:45 },
      { name:"åœ°ç“œæ‹‰é¤…", price:45 },
      { name:"æ³°å¼èŠ±æ", price:45 },
      { name:"ä¸‰ç‰‡åå¸", price:35 },
      { name:"åšç‰‡åå¸", price:40 },
      { name:"ä¹³é…ªé¤…", price:30 },
      { name:"ä¹³é…ªé¤…å¤¾åœŸå¸", price:40 },
      { name:"é›™è‰²åšç‰‡åå¸", price:45 }
    ]
  }
];

const categoriesView = document.getElementById("categoriesView");
const subcategoriesView = document.getElementById("subcategoriesView");
const itemsView = document.getElementById("itemsView");
const cartView = document.getElementById("cartView");
const subTitle = document.getElementById("subTitle");
const subList = document.getElementById("subList");
const itemsTitle = document.getElementById("itemsTitle");
const itemsList = document.getElementById("itemsList");
const cartList = document.getElementById("cartList");
const cartTotal = document.getElementById("cartTotal");

let cart = [];
let currentCategory = "";
let currentSubcategory = "";
let currentItems = [];

function renderCategories(){
  categoriesView.innerHTML = "<h3>è«‹é¸æ“‡åˆ†é¡ï¼š</h3>";
  menuData.forEach(cat => {
    const btn = document.createElement("button");
    btn.className = "category-btn";
    btn.textContent = cat.category;
    btn.onclick = () => {
      currentCategory = cat.category;
      if(cat.subcategories){
        showSubcategories(cat);
      } else {
        showItems(cat.items, cat.category);
      }
    };
    categoriesView.appendChild(btn);
  });
}

function showSubcategories(cat){
  categoriesView.classList.add("hidden");
  subcategoriesView.classList.remove("hidden");
  subTitle.textContent = `é¸æ“‡ã€Œ${cat.category}ã€ç´°é …ï¼š`;
  subList.innerHTML = "";
  cat.subcategories.forEach(sub => {
    const btn = document.createElement("button");
    btn.className = "category-btn";
    btn.textContent = sub.name;
    btn.onclick = () => {
      currentSubcategory = sub.name;
      showItems(sub.items, sub.name);
    };
    subList.appendChild(btn);
  });
}

function addToCart(item, title, qty, price, size, taste, freeDrink) {
  cart.push({
    category: title, // ğŸ’¡ ä½¿ç”¨ç•¶å‰é¡¯ç¤ºçš„titleé¿å…åˆ†é¡éŒ¯èª¤
    name: item.name,
    qty: parseInt(qty.value),
    price: price,
    size: size || "",
    taste: taste || "",
    freeDrink: freeDrink || ""
  });
}

function showItems(items, title){
  subcategoriesView.classList.add("hidden");
  categoriesView.classList.add("hidden");
  cartView.classList.add("hidden");
  itemsView.classList.remove("hidden");
  itemsTitle.textContent = title;
  currentItems = items;
  itemsList.innerHTML = "";

  items.forEach(item => {
    const div = document.createElement("div");
    div.className = "item";
    const nameDiv = document.createElement("div");
    nameDiv.className = "item-name";
    nameDiv.textContent = item.name;
    const priceDiv = document.createElement("div");
    priceDiv.textContent = item.priceM ? `M:${item.priceM}/L:${item.priceL}` : `${item.price}å…ƒ`;

    const controls = document.createElement("div");
    controls.className = "controls";
    let taste = "";
    let size = "";
    let freeDrink = "";

    // å…è²»é£²æ–™
    if(title.includes("éµæ¿éºµ") || title.includes("ç¾©å¤§åˆ©éºµ")){
      ["å¥¶èŒ¶","ç´…èŒ¶","ç„¡ç³–ç¶ èŒ¶"].forEach(drink=>{
        const btn = document.createElement("button");
        btn.textContent = drink;
        btn.className = "size-btn";
        btn.onclick = () => {
          freeDrink = drink;
          controls.querySelectorAll(".size-btn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
        };
        controls.appendChild(btn);
      });
    }

    // å£å‘³
    if(item.tasteOptions){
      item.tasteOptions.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.className = "taste-btn";
        btn.onclick = () => {
          taste = opt;
          controls.querySelectorAll(".taste-btn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
        };
        controls.appendChild(btn);
      });
    }

    // é£²æ–™å°ºå¯¸
    if(item.priceM){
      size = "M";
      const btnM = document.createElement("button");
      btnM.textContent = "M";
      btnM.className = "size-btn active";
      const btnL = document.createElement("button");
      btnL.textContent = "L";
      btnL.className = "size-btn";
      btnM.onclick = () => { size = "M"; btnM.classList.add("active"); btnL.classList.remove("active"); };
      btnL.onclick = () => { size = "L"; btnL.classList.add("active"); btnM.classList.remove("active"); };
      controls.append(btnM, btnL);
    }

    // æ•¸é‡æ§åˆ¶
    const minus = document.createElement("button");
    minus.textContent = "-";
    const qty = document.createElement("input");
    qty.type = "number"; qty.value = 0; qty.min = 0;
    const plus = document.createElement("button");
    plus.textContent = "+";
    minus.onclick = () => { if(qty.value>0) qty.value--; };
    plus.onclick = () => { qty.value++; };

    // åŠ å…¥è³¼ç‰©è»Š
    const add = document.createElement("button");
    add.textContent = "åŠ å…¥";
    add.onclick = () => {
      if(parseInt(qty.value) > 0){
        if(item.tasteOptions && !taste){ alert("è«‹é¸æ“‡å£å‘³"); return; }
        let p = item.price;
        if(item.priceM){ p = size === "M" ? item.priceM : item.priceL; }
        addToCart(item, title, qty, p, size, taste, freeDrink);
        qty.value = 0;
        alert("å·²åŠ å…¥è³¼ç‰©è»Š");
      } else {
        alert("è«‹é¸æ“‡æ•¸é‡");
      }
    };

    controls.append(minus, qty, plus, add);
    div.append(nameDiv, priceDiv, controls);
    itemsList.appendChild(div);
  });
}


function showCart(){
  itemsView.classList.add("hidden");
  categoriesView.classList.add("hidden");
  subcategoriesView.classList.add("hidden");
  cartView.classList.remove("hidden");
  cartList.innerHTML = "";
  let total = 0;
  cart.forEach((i, idx) => {
    total += i.qty * i.price;
    const div = document.createElement("div");
    div.className = "cart-item";
    let text = i.category;
    if(i.name==="è˜‘è‡" || i.name==="é»‘èƒ¡æ¤’"){
      text += `(${i.name})`;
    } else {
      if(i.taste){
        text += `(${i.taste})`;
      }
      text += ` ${i.name}`;
    }
    if(i.size){
      text += `(${i.size})`;
    }
    if(i.freeDrink){
      text += ` [é™„: ${i.freeDrink}]`;
    }
    text += ` x${i.qty} = ${i.qty*i.price}å…ƒ`;
    div.textContent = text;
    const del = document.createElement("button");
    del.textContent = "åˆªé™¤";
    del.onclick = () => { cart.splice(idx,1); showCart(); };
    div.appendChild(del);
    cartList.appendChild(div);
  });
  cartTotal.textContent = total;
}

function submitOrder(){
  if(cart.length === 0){ alert("è«‹å…ˆé¸è³¼å•†å“"); return; }
  const total = cart.reduce((sum, i) => sum + i.qty * i.price, 0);
  fetch("https://script.google.com/macros/s/AKfycbxZZe-wCY2oH5rjR8iuAE2wJYx9mNY5G-ql7rhEmWCUzXYLgK6gdvFA_4JxhaMbqKLnUw/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ items: cart, type: "å¤–å¸¶", table: "N/A", total: total, time: new Date().toLocaleString() })
  })
  .then(res => res.text())
  .then(msg => { alert("âœ… è¨‚å–®å·²é€å‡ºï¼\n"+msg); cart=[]; backToCategories(); })
  .catch(err => { alert("âŒ è¨‚å–®é€å‡ºå¤±æ•—ï¼š"+err); });
}

function backToCategories(){
  cartView.classList.add("hidden");
  itemsView.classList.add("hidden");
  subcategoriesView.classList.add("hidden");
  categoriesView.classList.remove("hidden");
}

renderCategories();

</script>
</body>
</html>
